<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { margin-top: 0; font-size: 1.2rem; color: #555; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        
        /* æ™‚è¨ˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #clock-container { text-align: center; }
        #date { font-size: 1.2rem; color: #666; }
        #time { font-size: 3rem; font-weight: bold; color: #0070f3; line-height: 1.2; font-variant-numeric: tabular-nums; }

        /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        ul.news-list { list-style: none; padding: 0; margin: 0; }
        ul.news-list li { padding: 10px 0; border-bottom: 1px solid #eee; }
        ul.news-list li:last-child { border-bottom: none; }
        ul.news-list a { text-decoration: none; color: #333; display: block; }
        ul.news-list a:hover { color: #0070f3; }
        .news-date { font-size: 0.8rem; color: #999; margin-right: 10px; }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰ */
        @media (max-width: 600px) {
            #time { font-size: 2.5rem; }
            body { padding: 10px; }
        }
    </style>
</head>
<body>

    <div class="card" id="clock-container">
        <div id="date">Loading...</div>
        <div id="time">00:00:00</div>
    </div>

    <div class="card">
        <h2>ãƒãƒ¼ã‚±ãƒƒãƒˆæƒ…å ±</h2>
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-quotes.js" async>
            {
            "width": "100%",
            "height": 350,
            "symbolsGroups": [
                {
                "name": "Indices & Forex",
                "originalName": "Indices",
                "symbols": [
                    { "name": "FOREXCOM:SPXUSD", "displayName": "S&P 500" },
                    { "name": "TVC:TOPIX", "displayName": "TOPIX" },
                    { "name": "AMEX:VOO", "displayName": "VOO (S&P500 ETF)" },
                    { "name": "FX_IDC:USDJPY", "displayName": "USD/JPY" }
                ]
                }
            ],
            "showSymbolLogo": true,
            "isTransparent": true,
            "colorTheme": "light",
            "locale": "ja"
            }
            </script>
        </div>
        </div>

    <div class="card">
        <h2>æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ (Yahoo! Topics)</h2>
        <ul id="news-list" class="news-list">
            <li>èª­ã¿è¾¼ã¿ä¸­...</li>
        </ul>
    </div>

    <div class="card">
        <h2>ãƒªãƒ³ã‚¯é›†</h2>
        <ul class="news-list">
            <li><a href="https://mail.google.com/" target="_blank">ğŸ“§ Gmail</a></li>
            <li><a href="https://calendar.google.com/" target="_blank">ğŸ“… Google Calendar</a></li>
        </ul>
    </div>

    <script>
        // --- æ©Ÿèƒ½1: æ™‚è¨ˆ (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç§’è¡¨ç¤º) ---
        function updateClock() {
            const now = new Date();
            // æ—¥ä»˜: 202Xå¹´XæœˆXæ—¥(æ›œ)
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' };
            document.getElementById('date').innerText = now.toLocaleDateString('ja-JP', dateOptions);
            
            // æ™‚åˆ»: HH:MM:SS (0åŸ‹ã‚)
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('time').innerText = `${h}:${m}:${s}`;
        }
        setInterval(updateClock, 1000); // 1ç§’ã”ã¨ã«æ›´æ–°
        updateClock(); // åˆå›å®Ÿè¡Œ

        // --- æ©Ÿèƒ½3: ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾— (è‡ªä½œAPIçµŒç”±) ---
        async function fetchNews() {
            const list = document.getElementById('news-list');
            try {
                // functions/news.js ã‚’å‘¼ã³å‡ºã™
                const res = await fetch('/news');
                if (!res.ok) throw new Error('Network response was not ok');
                
                // XMLãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦å—ã‘å–ã‚‹
                const text = await res.text();
                
                // XMLã‚’è§£æã™ã‚‹
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(text, "text/xml");
                const items = xmlDoc.querySelectorAll("item");

                list.innerHTML = ""; // ã€Œèª­ã¿è¾¼ã¿ä¸­ã€ã‚’æ¶ˆã™

                // è¨˜äº‹ã‚’ãƒ«ãƒ¼ãƒ—ã—ã¦è¡¨ç¤ºï¼ˆæœ€å¤§5ä»¶ï¼‰
                items.forEach((item, index) => {
                    if (index >= 5) return; // 5ä»¶ã¾ã§
                    const title = item.querySelector("title").textContent;
                    const link = item.querySelector("link").textContent;
                    
                    // ãƒªã‚¹ãƒˆã«è¿½åŠ 
                    const li = document.createElement("li");
                    li.innerHTML = `<a href="${link}" target="_blank">${title}</a>`;
                    list.appendChild(li);
                });

            } catch (error) {
                console.error(error);
                list.innerHTML = "<li>ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</li>";
            }
        }
        fetchNews();
    </script>
</body>
</html>